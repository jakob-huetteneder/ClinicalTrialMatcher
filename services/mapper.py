# Map the xml file to json format

# Example xml:
"""
<?xml version="1.0" encoding="UTF-8"?>
<clinical_study rank="10000">
  <!-- This xml conforms to an XML Schema at:
    https://clinicaltrials.gov/ct2/html/images/info/public.xsd -->
  <required_header>
    <download_date>ClinicalTrials.gov processed this data on June 09, 2023</download_date>
    <link_text>Link to the current ClinicalTrials.gov record.</link_text>
    <url>https://clinicaltrials.gov/show/NCT05685589</url>
  </required_header>
  <id_info>
    <org_study_id>00016672</org_study_id>
    <nct_id>NCT05685589</nct_id>
  </id_info>
  <brief_title>Mindfulness-Based Intervention for Teens With Autism Spectrum Disorder and Their Caregivers</brief_title>
  <official_title>Pilot Randomized Controlled Trial of a Telehealth Mindfulness-based Intervention for Adolescents With Autism Spectrum Disorder and Their Caregivers</official_title>
  <sponsors>
    <lead_sponsor>
      <agency>Southwest Autism Research &amp; Resource Center</agency>
      <agency_class>Other</agency_class>
    </lead_sponsor>
    <collaborator>
      <agency>Arizona State University</agency>
      <agency_class>Other</agency_class>
    </collaborator>
    <collaborator>
      <agency>Blue Cross Blue Shield of Arizona Foundation for Community and Health Advancement</agency>
      <agency_class>Other</agency_class>
    </collaborator>
  </sponsors>
  <source>Southwest Autism Research &amp; Resource Center</source>
  <oversight_info>
    <has_dmc>No</has_dmc>
    <is_fda_regulated_drug>No</is_fda_regulated_drug>
    <is_fda_regulated_device>No</is_fda_regulated_device>
  </oversight_info>
  <brief_summary>
    <textblock>
      This project will evaluate the effectiveness of MINDful TIME, an 8-week mindfulness-based&#xD;
      program designed to improve mental health in adolescents with autism spectrum disorder and&#xD;
      their caregivers. MINDful TIME includes weekly psychoeducational group meetings conducted&#xD;
      through videoconferencing and use of a commercially available mindfulness meditation app. We&#xD;
      predict that adolescents in the mindfulness intervention group will demonstrate increases in&#xD;
      self-reported mindfulness and reductions in self- and parent-reported anxiety and depression&#xD;
      relative to a delayed treatment control group. We will also explore whether caregivers in the&#xD;
      treatment group demonstrate improvements in quality of life.&#xD;
    </textblock>
  </brief_summary>
  <detailed_description>
    <textblock>
      Interested individuals and their parent/caregiver who meet preliminary eligibility criteria&#xD;
      during the phone screen will be scheduled for a 1-2 hour virtual study visit to complete an&#xD;
      intake interview for study and a brief IQ test. If individuals have completed this assessment&#xD;
      at SARRC within the last five years, they will not be re-assessed; however, they will&#xD;
      complete a 30-minute virtual intake visit to complete the intake interview, learn about the&#xD;
      intervention and determine if they would like to participate.&#xD;
&#xD;
      Participants in the treatment group will complete three virtual study visits (Baseline,&#xD;
      intervention exit, 2-month follow-up), whereas participants in the delayed treatment control&#xD;
      group will complete four virtual study visits (Baseline, wait for the period exit,&#xD;
      intervention exit, 2 month-follow-up). After completing their second-time point (i.e., wait&#xD;
      period exit) participants in the delayed treatment control group will be enrolled in the&#xD;
      8-week intervention.&#xD;
&#xD;
      We anticipate that the duration of an individual participant's participation in the study&#xD;
      from baseline data collection to study completion will be approximately 6 months.&#xD;
      Participants may be enrolled up to 8 months prior to their baseline data collection depending&#xD;
      on when they are recruited into the study and whether they participate in cohort 1 or cohort&#xD;
      2.&#xD;
    </textblock>
  </detailed_description>
  <overall_status>Recruiting</overall_status>
  <start_date type="Actual">January 4, 2023</start_date>
  <completion_date type="Anticipated">July 2024</completion_date>
  <primary_completion_date type="Anticipated">January 23, 2024</primary_completion_date>
  <phase>N/A</phase>
  <study_type>Interventional</study_type>
  <has_expanded_access>No</has_expanded_access>
  <study_design_info>
    <allocation>Randomized</allocation>
    <intervention_model>Parallel Assignment</intervention_model>
    <primary_purpose>Treatment</primary_purpose>
    <masking>None (Open Label)</masking>
  </study_design_info>
  <primary_outcome>
    <measure>Mean Change from Baseline in Children's Depression Inventory (CDI) Scores</measure>
    <time_frame>Post-intervention (8 weeks); 2-month follow-up</time_frame>
    <description>Parent-report measure of adolescent depressive symptoms.</description>
  </primary_outcome>
  <primary_outcome>
    <measure>Mean Change from Baseline in Multidimensional Anxiety Scale for Children (MASC) Scores</measure>
    <time_frame>Post-intervention (8 weeks); 2-month follow-up</time_frame>
    <description>Parent-report measure of adolescent anxiety symptoms.</description>
  </primary_outcome>
  <primary_outcome>
    <measure>Mean Change from Baseline in Child and Adolescent Mindfulness Measure (CAMM) Scores</measure>
    <time_frame>Post-intervention (8 weeks); 2-month follow-up</time_frame>
    <description>Adolescent-report measure of mindfulness.</description>
  </primary_outcome>
  <secondary_outcome>
    <measure>Mean Change from Baseline in Beck Youth Inventories (BYI) Scores</measure>
    <time_frame>Post-intervention (8 weeks); 2-month follow-up</time_frame>
    <description>Adolescent-report measure of depression, anxiety, anger, disruptive behavior, and self-concept.</description>
  </secondary_outcome>
  <secondary_outcome>
    <measure>Mean Change from Baseline in World Health Organization-Five Wellbeing Index (WHO-5) Scores</measure>
    <time_frame>Post-intervention (8 weeks); 2-month follow-up</time_frame>
    <description>Adolescent-report measure on current well-being.</description>
  </secondary_outcome>
  <secondary_outcome>
    <measure>Mean Change from Baseline in Adaptive Behavior Assessment System (ABAS-3) Scores</measure>
    <time_frame>Post-intervention (8 weeks); 2-month follow-up</time_frame>
    <description>Parent-report measure of adolescent adaptive skills across the lifespan.</description>
  </secondary_outcome>
  <secondary_outcome>
    <measure>Mean Change from Baseline in Social Responsiveness Scale (SRS-2) Scores</measure>
    <time_frame>Post-intervention (8 weeks); 2-month follow-up</time_frame>
    <description>Parent-report measure of adolescent presence and severity of social impairment within autism spectrum.</description>
  </secondary_outcome>
  <secondary_outcome>
    <measure>Mean Change from Baseline in Behavior Rating Inventory of Executive Function (BRIEF) Scores</measure>
    <time_frame>Post-intervention (8 weeks); 2-month follow-up</time_frame>
    <description>Parent-report measure of adolescent executive function and self-regulation.</description>
  </secondary_outcome>
  <secondary_outcome>
    <measure>Mean Change from Baseline in Five Facets Mindfulness Questionnaire (FFMQ) Scores</measure>
    <time_frame>Post-intervention (8 weeks); 2-month follow-up</time_frame>
    <description>Adolescent-report measure of mindfulness on observation, description, aware actions, non-judgmental inner experience, and non-reactivity.</description>
  </secondary_outcome>
  <secondary_outcome>
    <measure>Mean Change from Baseline in Family Quality of Life Scale (FQOL) Scores</measure>
    <time_frame>Post-intervention (8 weeks); 2-month follow-up</time_frame>
    <description>Parent-report measure of family quality of life in family interaction, parenting, emotional well-being, physical/material well-being, and disability-related support.</description>
  </secondary_outcome>
  <secondary_outcome>
    <measure>Mean Change from Baseline in Stress Index for Parents of Adolescents (SIPA) Scores</measure>
    <time_frame>Post-intervention (8 weeks); 2-month follow-up</time_frame>
    <description>Parent-report measure of the relationship of parenting stress to adolescent characteristics, parent characteristics, the quality of the adolescent-parent interactions, and stressful life circumstances.</description>
  </secondary_outcome>
  <number_of_arms>2</number_of_arms>
  <enrollment type="Anticipated">40</enrollment>
  <condition>Autism Spectrum Disorder</condition>
  <arm_group>
    <arm_group_label>Mindfulness-based Intervention</arm_group_label>
    <arm_group_type>Experimental</arm_group_type>
    <description>The intervention will include weekly 90-minute group meetings held online through Zoom. Adolescents and parents will meet in separate groups and will learn about mindfulness-based strategies that can be used to manage and reduce stress, anxiety, and depression. They will also learn evidence-based strategies to complete daily guided mindfulness meditations using Ten Percent Happier, a commercially-available mobile app. Participants will be encouraged to meditate using the mobile app for at least 10 minutes each day during and after the 8-week intervention.</description>
  </arm_group>
  <arm_group>
    <arm_group_label>Delayed Treatment Control</arm_group_label>
    <arm_group_type>No Intervention</arm_group_type>
    <description>Participants will be instructed to engage in treatment as usual during their 8-week wait period. After their wait period, participants will be enrolled in the mindfulness-based intervention.</description>
  </arm_group>
  <intervention>
    <intervention_type>Behavioral</intervention_type>
    <intervention_name>MINDful TIME</intervention_name>
    <description>The intervention will include weekly 90-minute group meetings held online through Zoom. Adolescents and parents will meet in separate groups and will learn about mindfulness-based strategies that can be used to manage and reduce stress, anxiety, and depression. They will also learn evidence-based strategies to complete daily guided mindfulness meditations using Ten Percent Happier, a commercially-available mobile app. Participants will be encouraged to meditate using the mobile app for at least 10 minutes each day during and after the 8-week intervention.</description>
    <arm_group_label>Mindfulness-based Intervention</arm_group_label>
  </intervention>
  <eligibility>
    <criteria>
      <textblock>
        Inclusion Criteria:&#xD;
&#xD;
          -  Adolescents must be ages 13 to 18 years&#xD;
&#xD;
          -  Formal clinical or educational ASD diagnosis confirmed by the study team (i.e., review&#xD;
             of the formal diagnostic or educational report)&#xD;
&#xD;
          -  Must be willing to be randomized to a treatment or delayed treatment control group&#xD;
&#xD;
          -  Must be able to attend at least 7 of the 8 group meetings&#xD;
&#xD;
          -  English speaking: Adolescents and their parent/caregivers must be English-speaking&#xD;
             because the screening and behavioral measures are in English, as well as the&#xD;
             intervention content&#xD;
&#xD;
          -  Participants must live in the state of Arizona, USA&#xD;
&#xD;
        Exclusion Criteria:&#xD;
&#xD;
          -  Non-verbal participants will be excluded to ensure test compliance and increase sample&#xD;
             homogeneity.&#xD;
&#xD;
          -  Participants with IQ scores &lt;70 will be excluded because the intervention was&#xD;
             developed for individuals without intellectual disabilities.&#xD;
&#xD;
          -  Participants with a physical disability or co-occurring condition that may prevent&#xD;
             participation in the weekly group meetings (e.g., selective mutism; aggressive&#xD;
             behavior; inability to participate in a 90-minute video conference meeting each week)&#xD;
&#xD;
          -  Participants who report active suicidal ideation&#xD;
      </textblock>
    </criteria>
    <gender>All</gender>
    <minimum_age>13 Years</minimum_age>
    <maximum_age>18 Years</maximum_age>
    <healthy_volunteers>No</healthy_volunteers>
  </eligibility>
  <overall_official>
    <last_name>Blair Braden, Ph.D</last_name>
    <role>Principal Investigator</role>
    <affiliation>Arizona State University</affiliation>
  </overall_official>
  <overall_official>
    <last_name>Nicole Matthews, Ph.D</last_name>
    <role>Principal Investigator</role>
    <affiliation>Southwest Autism Research and Resource Center</affiliation>
  </overall_official>
  <overall_contact>
    <last_name>Hyerin Yoon</last_name>
    <phone>623-473-6303</phone>
    <email>HYoon@autismcenter.com</email>
  </overall_contact>
  <overall_contact_backup>
    <last_name>Nicole Matthews, Ph.D</last_name>
    <phone>(480) 582-9499</phone>
    <email>NMatthews@autismcenter.org</email>
  </overall_contact_backup>
  <location>
    <facility>
      <name>Southwest Autism Research and Resource Center</name>
      <address>
        <city>Phoenix</city>
        <state>Arizona</state>
        <zip>85006</zip>
        <country>United States</country>
      </address>
    </facility>
    <status>Recruiting</status>
    <contact>
      <last_name>Hyerin Yoon</last_name>
      <phone>623-473-6303</phone>
      <email>HYoon@autismcenter.org</email>
    </contact>
    <contact_backup>
      <last_name>Nicole Matthews, Ph.D</last_name>
      <phone>480-582-9499</phone>
      <email>NMatthews@autismcenter.org</email>
    </contact_backup>
    <investigator>
      <last_name>Nicole Matthews, Ph.D</last_name>
      <role>Principal Investigator</role>
    </investigator>
  </location>
  <location_countries>
    <country>United States</country>
  </location_countries>
  <verification_date>January 2023</verification_date>
  <study_first_submitted>January 5, 2023</study_first_submitted>
  <study_first_submitted_qc>January 5, 2023</study_first_submitted_qc>
  <study_first_posted type="Actual">January 17, 2023</study_first_posted>
  <last_update_submitted>January 5, 2023</last_update_submitted>
  <last_update_submitted_qc>January 5, 2023</last_update_submitted_qc>
  <last_update_posted type="Actual">January 17, 2023</last_update_posted>
  <responsible_party>
    <responsible_party_type>Principal Investigator</responsible_party_type>
    <investigator_affiliation>Southwest Autism Research &amp; Resource Center</investigator_affiliation>
    <investigator_full_name>Nicole Matthews, Ph.D.</investigator_full_name>
    <investigator_title>Director of Research</investigator_title>
  </responsible_party>
  <condition_browse>
    <!-- CAUTION:  The following MeSH terms are assigned with an imperfect algorithm            -->
    <mesh_term>Autistic Disorder</mesh_term>
    <mesh_term>Autism Spectrum Disorder</mesh_term>
    <mesh_term>Child Development Disorders, Pervasive</mesh_term>
  </condition_browse>
  <patient_data>
    <sharing_ipd>Yes</sharing_ipd>
    <ipd_description>All individual participant data (IPD) that underlie results in a publication will be available upon request to approved researchers.</ipd_description>
    <ipd_info_type>Study Protocol</ipd_info_type>
    <ipd_time_frame>Data will be available upon request starting 6 months after publication and will remain available for 2 years.</ipd_time_frame>
    <ipd_access_criteria>Data requests should be submitted to Dr. Nicole Matthews at nmatthews@autismcenter.org and must include study aims and purpose and a detailed analysis plan describing how the data will be used. Requests will be reviewed by Dr. Matthews and access to the data will be made available through a secure link to download the requested data.</ipd_access_criteria>
  </patient_data>
  <!-- Results have not yet been posted for this study                                          -->
</clinical_study>
"""

# Example json:
# {
#     "title": "Effects of Two Different Applications in Fibromyalgia",
#     "startDate": "2023-06-15",
#     "endDate": "2023-06-30",
#     "researcher": "Biruni University",
#     "studyType": "Interventional",
#     "briefSummary": "The purpose of this study is to investigate the effects of connective tissue massage and kinesio tape application on pain, quality of life, depression and anxiety in patients with fibromyalgia.",
#     "detailedSummary": "Fibromyalgia is a chronic disease characterized by widespread pain, fatigue, sleep disorders, cognitive disorders and psychological symptoms. The prevalence of fibromyalgia is 2-4% in the general population. The etiology of fibromyalgia is not fully known. However, it is thought that the central nervous system is sensitized by the interaction of genetic, environmental and psychological factors. The most common symptoms of fibromyalgia are pain, fatigue, sleep disorders, cognitive disorders and psychological symptoms. The diagnosis of fibromyalgia is made by the American College of Rheumatology (ACR) 2010 diagnostic criteria. The diagnosis of fibromyalgia is made by the American College of Rheumatology (ACR) 2010 diagnostic criteria. The diagnosis of fibromyalgia is made by the American College of Rheumatology (ACR) 2010 diagnostic criteria. The diagnosis of fibromyalgia is made by the American College of Rheumatology (ACR) 2010 diagnostic criteria.",
#     "sponsor": "Biruni University",
#     "collaborator": "",
#     "status": "Not recruiting",
#     "location": "",
#     "crGender": "All",
#     "crMinAge": 20,
#     "crMaxAge": 55,
#     "includeCriteria": [],
#     "excludeCriteria": [],
# }

from xml.dom import minidom
import os
import sys
import json
import re
import datetime
from extractor import pipeline

# hidden filename for storing the selection
SELECTION_CONTEXT_FILE = '.selectionContext.json'

def print_help():
    print('This script parses the trials in the specified folder and outputs a json file with the parsed data.')
    print('The script can be run in two modes: per default the user is asked for every trial if it should be included in the output file.')
    print('Alternatively, the user can specify the -a flag to just parse all trials without selection.')
    print('It is also possible to stop the selection process by pressing Ctrl+C. The script will then continue from the last saved state.')
    print('If the user wants to start from the beginning, the -r flag can be specified.')
    print('python3 mapper.py [-h] [-o OUTPUT] [-n NUMBER] [-r] [-a] PATH')
    print('')
    print('  -h, --help                    show this help message and exit')
    print('  -o OUTPUT, --output OUTPUT    output file name')
    print('  -n NUMBER, --number NUMBER    number of trials to process')
    print('  -r, --restart                 start from the beginning')
    print('  -a                            map all trials without selection')
    print('  -y                            remap all trials without selection (from existing selection file)')
    print('  PATH                          path to the folder containing the trials')
    print('')


def main():

    if len(sys.argv) < 2:
        print_help()
        return

    if '-h' in sys.argv:
        print_help()
        return
        
    # get path
    path = sys.argv[-1]

    if not os.path.exists(path):
        print('Path does not exist')
        return

    if not os.path.isdir(path):
        print('Path is not a folder')
        return

    # check flags
    startFromBeginning = False
    outputFileName = 'trials.json'
    numberOfTrials = 100
    doSelection = True
    remap = False

    if '-r' in sys.argv:
        startFromBeginning = True
    if '-o' in sys.argv:
        outputFileName = sys.argv[sys.argv.index('-o') + 1]
    if '-n' in sys.argv:
        numberOfTrials = int(sys.argv[sys.argv.index('-n') + 1])
    if '-a' in sys.argv:
        doSelection = False
    if '-y' in sys.argv :
        remap = True
        

    # get all files from folder "trials" with .xml extension
    trials = []
    for file in os.listdir(path):
        if file.endswith('.xml'):
            trials.append(path + '/' + file)
    
    print(f'Found {len(trials)} trials')

    if remap:
        remapTrials(trials, outputFileName)
        return

    if len(trials) > numberOfTrials:
        trials = trials[:numberOfTrials]

    print(f'Processing {len(trials)} trials')

    selectedTrials = []
    selectionContext = []

    if not startFromBeginning:
        if (os.path.exists(SELECTION_CONTEXT_FILE)):
            with open(SELECTION_CONTEXT_FILE, 'r') as selectionContextFile:
                selectionContext = json.load(selectionContextFile)
                trials = trials[len(selectionContext):]

                with open(outputFileName, 'r') as selectedTrialsFile:
                    selectedTrials = json.load(selectedTrialsFile)

    try:
        for trial in trials:
            print(f'Processing {trial}')
            mappedTrial = mapTrial(trial)
            print(json.dumps(mappedTrial, indent=2))
            isAccepted = not doSelection or get_acceptance()
            if isAccepted:
                selectedTrials.append(mappedTrial)
            else:
                print(f'Skipping trial {trial}')
            selectionContext.append({
                'file': trial,
                'selected': isAccepted
            })
            print('-------------------')
    except KeyboardInterrupt:
        print('Stopping to select trials')
    finally:
        with open(SELECTION_CONTEXT_FILE, 'w') as selectionContextFile:
            with open('trials.json', 'w') as selectedTrialsFile:
                print('Writing trials')
                json.dump(selectionContext, selectionContextFile, indent=2)
                json.dump(selectedTrials, selectedTrialsFile, indent=2)
                print('Done')

def get_acceptance():
    print('Accept this trial (y/n)?')
    while True:
        answer = input()
        if answer == 'y':
            return True
        elif answer == 'n':
            return False
        else:
            print('Please enter y or n')
        
    
def mapTrial(file):
    # read xml file
    xml = minidom.parse(file)

    # parse xml
    json = {}

    json['file'] = file

    # get title
    json['title'] = get_value(xml, 'brief_title')

    # get start date
    json['startDate'] = parse_date(get_value(xml, 'start_date'))

    # get end date
    json['endDate'] = parse_date(get_value(xml, 'completion_date'))

    # get researcher
    json['researcher'] = parse_researcher(get_value(xml, ['overall_official', 'last_name'], ['overall_contact', 'last_name'], ['contact', 'last_name']))

    # get study type
    json['studyType'] = get_value(xml, 'study_type')

    # get brief summary
    json['briefSummary'] = re.sub('\s+', ' ', get_value(xml, ['brief_summary', 'textblock']).replace('\n', ' ').replace('\r', ' ').replace('\t', ' '))

    # get detailed description
    json['detailedSummary'] = get_value(xml, ['detailed_description', 'textblock'])

    # get sponsor
    json['sponsor'] = get_value(xml, ['sponsors', 'lead_sponsor', 'agency'])

    # get collaborator
    json['collaborator'] = get_value(xml, ['sponsors', 'collaborator', 'agency'])

    # get status
    json['status'] = parse_status(get_value(xml, 'overall_status'))

    # get location
    json['location'] = get_value(xml, ['location', 'facility', 'name'], 'source')

    # get gender
    json['crGender'] = parse_gender(get_value(xml, ['eligibility', 'gender']))

    # get min age
    json['crMinAge'] = parse_age(get_value(xml, ['eligibility', 'minimum_age']), True)

    # get max age
    json['crMaxAge'] = parse_age(get_value(xml, ['eligibility', 'maximum_age']), False)

    # get eligibility criteria
    eligibility_criteria = get_value(xml, ['eligibility', 'criteria', 'textblock'])
    criteria = parse_criteria(eligibility_criteria)
    json['inclusionCriteria'] = criteria['inclusion']
    json['exclusionCriteria'] = criteria['exclusion']
    
    
    return json

def remapTrials(trials, outputFileName):
    isTrialSelected = []
    with open(SELECTION_CONTEXT_FILE, 'r') as selectedTrialsFile:
        isTrialSelected = json.load(selectedTrialsFile)
      
    selectedTrials = []
    for i in range(len(isTrialSelected)):
        if isTrialSelected[i]['selected']:
            selectedTrials.append(mapTrial(trials[i]))

    with open(outputFileName, 'w') as selectedTrialsFile:
        json.dump(selectedTrials, selectedTrialsFile, indent=2)

# this function takes a tag or a list of tags and returns the first tag that with the tag or the hierarchy of tags
# also take an arbitrary number of lists of tags that can be checked if the first tag is not found
def get_value(xml, tags, *alt_tags):
    if isinstance(tags, str):
        tags = [tags]
    
    allElements = xml.getElementsByTagName(tags[0])
    for element in allElements:
        if len(tags) == 1:
            return element.firstChild.nodeValue.strip()
        else:
            value = get_value(element, tags[1:], *alt_tags)
            if value != "":
                return value
    if len(alt_tags) > 0:
        return get_value(xml, alt_tags[0], *alt_tags[1:])
    return ""

def parse_criteria(criteria):
    inclusion_criteria = []
    exclusion_criteria = []

    # split criteria by inclusion and exclusion
    criteria = criteria.split('Exclusion Criteria:')
    if len(criteria) != 2 or len(criteria[0].split('Inclusion Criteria:')) != 2:
        print('Error: criteria not split correctly')
        return {'inclusion': [], 'exclusion': []}
    inclusion_criteria = criteria[0].split('Inclusion Criteria:')[1]
    exclusion_criteria = criteria[1]
    
    # remove all non alphanumeric characters (except spaces and dashes)
    inclusion_criteria = re.sub(r'[^a-zA-Z0-9 -\',\n]', ' ', inclusion_criteria)
    exclusion_criteria = re.sub(r'[^a-zA-Z0-9 -\',\n]', ' ', exclusion_criteria)

    inclusion_criteria = pipeline(inclusion_criteria)
    exclusion_criteria = pipeline(exclusion_criteria)

    return {'inclusion': inclusion_criteria, 'exclusion': exclusion_criteria}

# parse the date from the following representation:
"""
    "January 1, 2019"
    "January 2019"
"""
def parse_date(date_str):
    if ',' in date_str:
        date_obj = datetime.datetime.strptime(date_str, '%B %d, %Y')
    else:
        date_obj = datetime.datetime.strptime(date_str, '%B %Y')
    formatted_date = date_obj.strftime('%Y-%m-%d')
    return formatted_date

# parse the researcher from the following representation:
"""
    "John Doe, MD"
    "John Doe"
"""
def parse_researcher(researcher_str):
    if ',' in researcher_str:
        researcher_str = researcher_str.split(',')[0]
    
    names = researcher_str.split(' ')
    researcher = {
        'firstName': 'John',
        'lastName': 'Doe',
        'email': 'john.doe@example.com',
    }
    if len(names) == 1 and names[0] != '':
        researcher['firstName'] = names[0]
        researcher['email'] = names[0].lower() + '@example.com'
    elif len(names) == 2:
        researcher['firstName'] = names[0]
        researcher['lastName'] = names[1]
        researcher['email'] = names[0].lower() + '.' + names[1].lower() + '@example.com'


    return researcher

# parse status
def parse_status(status_str):
    if not status_str == 'Recruiting':
        status_str = 'Not_Recruiting'
    return status_str.upper()

# parse the gender from the following representation:
"""
    "Any"
    "Male"
    "Female"
"""
def parse_gender(gender_str):
    if gender_str == 'Any' or gender_str == 'All':
        gender_str = 'Both'
    
    return gender_str.upper();
  

# parse the age from the following representation:
"""
    "13 Years"
    "18 Years"
    "25 Weeks"
    "N/A"
"""
def parse_age(age_str, is_min_age):
    if age_str == 'N/A':
        return 0 if is_min_age else 99
        return age_str
    age = int(age_str.split(' ')[0])
    if 'Year' in age_str:
        pass
    elif 'Month' in age_str:
        age = int(age / 12)
    elif 'Week' in age_str:
        age = int(age / 52)
    elif 'Day' in age_str:
        age = int(age / 365)
    else:
        print('Error: age not recognized')
        return 'N/A'
        
    return age

    

if __name__ == '__main__':
    main()
