<div class="fw-bold grid grid-cols-1 justify-items-center container mt-3 ml-3 text-in-button">
  <div class="text-xl mb-3 mt-3"></div>
</div>

<div class="whitebox flex justify-center container mb-10">
  <div class="fw-bold grid grid-cols-1 justify-items-center container mt-3 ml-3">
    <div class="text-lg">Register new Patient</div>
  </div>

  <hr class="container">

  <div class="container lg:grid lg:grid-cols-2 flex flex-col">
    <div class="flex flex-row">
      <div class="flex flex-col flex-initial">
        <div class="fw-bold mb-3 mt-3"><i class="bi bi-person-fill mr-2"></i></div>
        <div class="fw-bold mb-3 mt-3"><i class="bi bi-envelope-at-fill mr-2"></i></div>
        <div class="fw-bold mb-3 mt-3"><i class="bi bi-calendar3-event mr-2"></i></div>
      </div>
      <div class="flex flex-col flex-initial">
        <div class="font-semibold mb-3 mt-3">First Name:</div>
        <div class="font-semibold mb-3 mt-3">E-Mail:</div>
        <div class="font-semibold mb-3 mt-3">Birthdate:</div>
      </div>
      <div class="flex flex-col flex-1">
        <input #fNameModel="ngModel" [(ngModel)]="toRegister.firstName"
               [class]="dynamicCssClassesForInput(fNameModel)"
               class="lg:ml-5 ml-10 mr-5 h-10 mb-2 mt-2 inputfield border-0"
               placeholder="Enter Patient's First Name" type="text">
        <input #emailModel="ngModel" [(ngModel)]="toRegister.email"
               [class]="dynamicCssClassesForInput(emailModel)"
               class="lg:ml-5 ml-10 mr-5 h-10 mb-2 mt-2 inputfield border-0"
               placeholder="Enter Patient's E-Mail" type="email">
        <input #dobModel="ngModel" [(ngModel)]="toRegister.birthdate"
               [class]="dynamicCssClassesForInput(dobModel)"
               class="lg:ml-5 ml-10 mr-5 h-10 mb-2 mt-2 inputfield border-0"
               placeholder="Enter Patient's Date of Birth" type="date">
      </div>
    </div>

    <div class="flex flex-row">
      <div class="flex flex-col flex-initial">
        <div class="fw-bold mb-3 mt-3"><i class="bi bi-person-fill mr-2"></i></div>
        <div class="fw-bold mb-3 mt-3"><i class="bi bi-envelope-at-fill mr-2"></i></div>
        <div class="fw-bold mb-3 mt-3"><i class="bi bi-gender-ambiguous mr-2"></i></div>
      </div>
      <div class="flex flex-col flex-initial">
        <div class="font-semibold mb-3 mt-3">Last Name:</div>
        <div class="font-semibold mb-3 mt-3">Repeat E-Mail:</div>
        <div class="font-semibold mb-3 mt-3">Gender:</div>
      </div>
      <div class="flex flex-col flex-1">
        <input #lNameModel="ngModel" [(ngModel)]="toRegister.lastName" [class]="dynamicCssClassesForInput(lNameModel)"
               class="ml-5 mr-5 h-10 mb-2 mt-2 inputfield border-0"
               placeholder="Enter Patient's Last Name" type="text">
        <input #emailModel="ngModel" [(ngModel)]="checkmail" [class]="dynamicCssClassesForInput(emailModel)"
               class="ml-5 mr-5 h-10 mb-2 mt-2 inputfield border-0"
               placeholder="Repeat Patient's E-Mail" type="email">
        <select [(ngModel)]="this.toRegister.gender"
                class="inputfield border-0 ml-5 mr-5 h-10 mb-2 mt-2 hover:cursor-pointer"
                id="gender"
                name="gender"
                style="background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIGZpbGw9J25vbmUnIHZpZXdCb3g9JzAgMCAyNCAyNCcgc3Ryb2tlLXdpZHRoPScxLjUnIHN0cm9rZT0nIzc4OThiZCcgY2xhc3M9J3ctNiBoLTYnPjxwYXRoIHN0cm9rZS1saW5lY2FwPSdyb3VuZCcgc3Ryb2tlLWxpbmVqb2luPSdyb3VuZCcgZD0nTTE5LjUgOC4yNWwtNy41IDcuNS03LjUtNy41JyAvPjwvc3ZnPgo=');                        background-position: right 0.5rem center;
                        background-repeat: no-repeat;
                        background-size: 1.5em 1.5em;">
          <option value="FEMALE">Female</option>
          <option value="MALE">Male</option>
        </select>
      </div>
    </div>
  </div>

  <hr class="container">

  <div class="container flex flex-col">
    <div>
      <div class="flex flex-row">
        <div class="flex flex-row flex-initial">
          <div class="fw-bold mb-2 mt-1"><i class="bi bi-journals mr-2"></i></div>
        </div>
        <div class="flex flex-col flex-initial">
          <div class="font-semibold mb-1 mt-1 mr-1">
            Admission Note
          </div>
        </div>
        <div class="flex-initial single-button ml-5 mt-1">
          <a class="group relative dropdown cursor-pointer tracking-wide pb-2 flex flex-row">
            <i class="bi-info-circle w-4 text-blue-950"></i>
            <div
              class="group-hover:cursor-text p-3 absolute border border-slate-100 top-6 z-10 w-96 hidden list-none overflow-hidden rounded-lg backdrop-blur-lg shadow-md group-hover:flex flex-row right gap-2">
              <i class="text-red-600 bi bi-exclamation-circle flex-initial"></i>
              <p class="text-justify text-xs text-slate-700 m-0">
                Please note that the analyzer tool is designed specifically for extracting diseases from your admission
                note. However, it is important to be aware that it may generate incorrect information or overlook
                essential details. <b>Therefore, we highly recommend double-checking your diagnoses after using the
                tool.</b>
              </p>
            </div>
          </a>
        </div>
      </div>
      <div class="flex flex-row">
        <div class="flex flex-col flex-1">
<textarea *ngIf="!highlight" #admissionModel="ngModel" [(ngModel)]="toRegister.admissionNote"
          [class]="dynamicCssClassesForInput(admissionModel)"
          class="mr-5 h-10 mb-2 inputfield border-0 min-h-auto min-h-[5rem]"
          placeholder="Enter the admission notes for your patient"></textarea>

          <div *ngIf="highlight" class="flex flex-col">
            <div #admissionModel="ngModel" [(ngModel)]="toRegister.admissionNote"
                 [class]="dynamicCssClassesForInput(admissionModel)"
                 class="mr-5 min-h-auto min-h-[5rem] mb-2 inputfield border-0 textarea-like"
                 style="display: flex; flex-direction: column; height: 100%;">
              <div (click)="highlight = false" class="p-2 hover:cursor-pointer"
                   style="flex: 1; overflow: auto; width: 100%;"
                   [innerHTML]="sanitizeHTML(analyzedText)">
              </div>
            </div>

          </div>


        </div>
        <div class="flex flex-row flex-initial">
          <button [disabled]="this.toRegister.admissionNote === '' || analyzing" (click)="analyze()"
                  class="{{buttonstyleAdmission()}} rounded w-35 p-2 h-10 mr-5 text-white relative disabled:cursor-not-allowed disabled:opacity-60">
            <span [ngClass]="{'invisible': analyzing}">Analyze Note</span>
            <span *ngIf="analyzing" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
              <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
                   viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                      d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <hr class="container">

  <div class="container flex flex-col">
    <div class="flex flex-row">
      <div class="flex flex-row flex-initial">
        <div class="fw-bold mb-2 mt-1"><i class="bi bi-activity mr-2"></i></div>
      </div>
      <div class="flex flex-col flex-initial">
        <div class="font-semibold mb-1 mt-1 mr-1">
          Diagnoses
        </div>
      </div>
      <div class="flex flex-row flex-initial">
        <div (click)="add()" class="fw-bold mb-2 mt-1 hover:cursor-pointer"><i class="bi bi-plus-lg ml-2"></i></div>
      </div>
      <div class="flex flex-1 justify-end mr-5">
        <app-confirm-button (confirm)="toRegister.diagnoses=[]" details="All diagnoses will be lost permanently.">
          <button class="rounded w-35 p-2 mt-2 h-10 text-black ml-0">
            <i class="font-bold bi bi-x-lg"></i>
          </button>
        </app-confirm-button>
      </div>
    </div>
    <div *ngFor="let diagnosis of toRegister.diagnoses" class="flex lg:flex-row flex-col">
      <div class="flex flex-col flex-1">
        <app-autocomplete
          [(ngModel)]="diagnosis.disease"
          [formatModel]="formatDiseaseName"
          [suggestions]="diseaseSuggestions"
          class="flex-1 flex flex-row"
          name="disease"
        ></app-autocomplete>
      </div>
      <div class="flex flex-col flex-1">
          <textarea #diagNote="ngModel" [(ngModel)]="diagnosis.note" [class]="dynamicCssClassesForInput(diagNote)"
                    class="min-h-[2.5rem] mr-2 h-10 mb-2 mt-2 inputfield border-0"
                    maxlength="1000"
                    placeholder="Notes" type="text"></textarea>
      </div>
      <div class="flex flex-col flex-1">
        <input #diagDate="ngModel" [(ngModel)]="diagnosis.date" [class]="dynamicCssClassesForInput(diagDate)"
               class="max-h-[2.5rem] mr-2 h-10 mb-2 mt-2 inputfield border-0"
               placeholder="Notes" type="date">
      </div>
      <div class="flex flex-col flex-initial">
        <app-confirm-button (confirm)="remove(diagnosis)" details="Diagnosis will be lost permanently.">
          <button class="rounded w-35 p-2 mt-2 h-10 text-black mr-5 ml-0">
            <i class="bi bi-dash-lg"></i>
          </button>
        </app-confirm-button>
      </div>
    </div>
  </div>

  <hr class="container">

  <div class="container flex flex-col">
    <div class="flex flex-row">
      <div class="flex flex-row flex-initial">
        <div class="fw-bold mb-2 mt-1"><i class="bi bi-paperclip mr-2"></i></div>
      </div>
      <div class="flex flex-col flex-initial">
        <div class="font-semibold mb-1 mt-1 mr-1">
          Examinations
        </div>
      </div>
      <div class="flex flex-row flex-initial">
        <div (click)="addExam()" class="fw-bold mb-2 mt-1 hover:cursor-pointer"><i class="bi bi-plus-lg ml-2"></i>
        </div>
      </div>
      <div class="flex flex-1 justify-end mr-5">
        <app-confirm-button (confirm)="toRegister.examinations=[]" details="All examinations will be lost permanently.">
          <button class="rounded w-35 p-2 mt-2 h-10 text-black ml-0">
            <i class="font-bold bi bi-x-lg"></i>
          </button>
        </app-confirm-button>
      </div>
    </div>
    <div *ngFor="let examination of toRegister.examinations" class="flex lg:flex-row flex-col">
      <div class="flex flex-col flex-1">
        <input #examName="ngModel" [(ngModel)]="examination.name"
               [class]="dynamicCssClassesForInput(examName)"
               class="max-h-[2.5rem] mr-2 h-10 mb-2 mt-2 inputfield border-0"
               placeholder="Name of Examination" type="text">
      </div>
      <div class="flex flex-col flex-1">
          <textarea #examNote="ngModel" [(ngModel)]="examination.note" [class]="dynamicCssClassesForInput(examNote)"
                    class="min-h-[2.5rem] mr-2 h-10 mb-2 mt-2 inputfield border-0"
                    maxlength="1000"
                    placeholder="Notes" type="text"></textarea>
      </div>
      <div class="flex flex-col flex-1">
        <input #examType="ngModel" [(ngModel)]="examination.type" [class]="dynamicCssClassesForInput(examType)"
               class="max-h-[2.5rem] mr-2 h-10 mb-2 mt-2 inputfield border-0"
               placeholder="Type" type="text">
      </div>
      <div class="flex flex-col flex-1">
        <input #examDate="ngModel" [(ngModel)]="examination.date"
               [class]="dynamicCssClassesForInput(examDate)"
               class="max-h-[2.5rem] mr-2 h-10 mb-2 mt-2 inputfield border-0"
               placeholder="Date of Examination" type="date">
      </div>
      <div class="flex flex-col flex-initial">
        <app-confirm-button (confirm)="removeExam(examination)" details="Examination will be lost permanently.">
          <button class="rounded w-35 p-2 mt-2 h-10 text-black mr-5 ml-0">
            <i class="bi bi-dash-lg"></i>
          </button>
        </app-confirm-button>
      </div>
    </div>
  </div>

  <button (click)="submit()" [disabled]="disable()" class="{{buttonstyle()}} rounded w-35 pl-4 pt-2 pb-2 mt-2 h-10 text-white flex items-center justify-center {{!loading ? 'pr-4' : ''}}">
    <span [ngClass]="{'invisible': loading}" class="inline-block">Complete Registration</span>
    <span [hidden]="!loading" class="relative top-2 left-2 -translate-x-24 -translate-y-2">
    <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
         viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
  </span>
  </button>

</div>
